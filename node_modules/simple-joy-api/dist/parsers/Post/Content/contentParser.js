"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const ContentElement_1 = __importDefault(require("../../../models/Post/Content/ContentElement"));
class ContentParser {
    parse(elements) {
        const contentElements = [];
        elements.map((el) => {
            const object = new ContentElement_1.default();
            if (el.attribs && el.attribs.class === 'image') {
                ContentParser.parseMediaContent(el, object);
                contentElements.push(object);
            }
            else {
                ContentParser.parseTextContent(el, object);
                if (object.data) {
                    contentElements.push(object);
                }
                if (el.children) {
                    contentElements.push(...this.parse(el.children));
                }
            }
        });
        return contentElements;
    }
    static parseTextContent(el, object) {
        const textTags = ['h3', 'p'];
        if (textTags.includes(el.name)) {
            object.type = el.name;
            object.data = ContentParser.searchText(el.children);
        }
        if (el.name === 'a') {
            if (el.attribs.href) {
                object.type = 'a';
                object.data = el.children[0] ? String(el.children[0].data) : null;
                object.link = el.attribs.href;
            }
        }
        return object;
    }
    static searchText(elements) {
        let text = null;
        elements.map((el) => {
            if (el.data && el.data.length > 0) {
                text = el.data;
            }
            if (!text && el.children.length > 0) {
                text = ContentParser.searchText(el.children);
            }
        });
        return text;
    }
    static parseMediaContent(el, object) {
        const children = el.children[0];
        if (children.name === 'img') {
            object.type = ContentElement_1.default.IMAGE_TYPE;
            object.data = children.attribs.src;
        }
        if (children.name === 'a') {
            object.type = ContentElement_1.default.IMAGE_TYPE;
            object.data = children.children[0].attribs.src;
        }
        if (children.name === 'span') {
            object.type = ContentElement_1.default.VIDEO_TYPE;
            object.data = children.children[0].attribs.href;
        }
        if (children.name === 'iframe') {
            object.type = ContentElement_1.default.IFRAME_TYPE;
            object.data = children.attribs.src;
        }
        return object;
    }
}
exports.default = new ContentParser();
